(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,7141,e=>{"use strict";var a=e.i(43476),t=e.i(71645),s=e.i(13826),r=e.i(75460),d=e.i(83375),i=e.i(46254);function l(){let{user:e}=(0,d.useAuth)(),[l,n]=(0,t.useState)([]),[o,c]=(0,t.useState)("idle"),[m,h]=(0,t.useState)([]),g=async()=>{c("loading"),h(e=>["Fetching data from API...",...e]);try{let e=await fetch("/api/read-csv"),a=await e.json();if(a.error)throw Error(a.error);n(a.data),c("loaded"),h(e=>[`Loaded ${a.data.length} records. Ready to import.`,...e])}catch(e){c("error"),h(a=>[`Error loading data: ${e.message}`,...a])}},u=e=>{if(!e)return"";let a=e.trim();if(/^\d{4}-\d{2}-\d{2}$/.test(a))return a;let t=a.match(/^(\d{1,2})[\/-](\d{1,2})[\/-](\d{4})$/);if(t){let e=t[1].padStart(2,"0"),a=t[2].padStart(2,"0"),s=t[3];return`${s}-${a}-${e}`}let s=new Date(a);if(!isNaN(s.getTime())){let e=s.toISOString().split("T")[0];if(e.startsWith("19")||e.startsWith("20"))return e}return a},x=async()=>{if(!e)return void alert("User not authenticated");c("importing");let a=0,t=0,s=l.length;for(let r=0;r<s;r++){let d=l[r],n={...d,tarikhPengislaman:u(d.tarikhPengislaman),pendapatanBulanan:d.pendapatanBulanan?d.pendapatanBulanan.toString():"",status:"active"};try{let{id:l,error:o}=await (0,i.createSubmission)(n,e.uid);o?(h(e=>[`[${r+1}/${s}] Failed: ${d.namaIslam||"Record"} - ${o}`,...e]),t++):(r%10==0&&h(e=>[`[${r+1}/${s}] Imported: ${d.namaIslam||d.namaAsal}`,...e]),a++)}catch(e){h(a=>[`[${r+1}/${s}] Error: ${e.message}`,...a]),t++}r%20==0&&await new Promise(e=>setTimeout(e,10))}c("done"),h(e=>[`FINISHED. Success: ${a}, Failed: ${t}`,...e])};return(0,a.jsx)(r.default,{children:(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,a.jsx)(s.default,{}),(0,a.jsxs)("div",{className:"max-w-6xl mx-auto p-8",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold mb-4 text-gray-800",children:"CSV Import Utility"}),(0,a.jsxs)("p",{className:"mb-4 text-gray-600",children:["Reads local file: ",(0,a.jsx)("code",{className:"bg-gray-200 px-1 rounded",children:"/Users/sasuhai/Desktop/HCFBTR/SPO2025.csv"})]}),(0,a.jsxs)("div",{className:"space-x-4 mb-6",children:[(0,a.jsx)("button",{onClick:g,className:"px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded shadow disabled:opacity-50",disabled:"importing"===o||"loading"===o,children:"loading"===o?"Loading...":"1. Load CSV Data"}),(0,a.jsxs)("button",{onClick:x,className:"px-6 py-2 bg-emerald-600 hover:bg-emerald-700 text-white rounded shadow disabled:opacity-50 disabled:cursor-not-allowed",disabled:"loaded"!==o,children:["2. Start Import (",l.length," Records)"]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-semibold mb-2",children:"Import Log"}),(0,a.jsxs)("div",{className:"bg-black text-green-400 p-4 rounded h-96 overflow-y-auto font-mono text-xs border border-gray-800 shadow-inner",children:[0===m.length&&(0,a.jsx)("span",{className:"text-gray-500",children:"Waiting to start..."}),m.map((e,t)=>(0,a.jsx)("div",{className:"mb-1",children:e},t))]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-semibold mb-2",children:"Data Preview (First 3)"}),l.length>0?(0,a.jsx)("div",{className:"bg-white p-4 rounded h-96 overflow-y-auto border border-gray-200 text-xs shadow-sm",children:(0,a.jsx)("pre",{children:JSON.stringify(l.slice(0,3),null,2)})}):(0,a.jsx)("div",{className:"bg-gray-100 p-4 rounded h-96 flex items-center justify-center text-gray-400 text-sm",children:"No Data Loaded"})]})]})]})]})})}e.s(["default",()=>l])}]);